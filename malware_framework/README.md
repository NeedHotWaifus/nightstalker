# Malware Framework - Advanced Red Team Simulation Platform

A production-ready, modular malware framework designed for ethical red teaming, penetration testing, and security research, now fully integrated with the NightStalker Advanced Offensive Security Framework.

## ⚠️ Legal Notice

**This framework is designed STRICTLY for:**
- Authorized security testing and research
- Educational purposes
- Ethical red teaming with proper authorization
- Security simulation and training

**Users are responsible for ensuring they have proper authorization before using this tool against any target. The authors are not responsible for any misuse of this software.**

## 🌟 Enhanced Features

- **Modular Architecture**: Clean separation of concerns with plugin-based modules
- **Multi-Platform Support**: Windows, Linux, and macOS compatibility
- **Stealth Operations**: Advanced evasion and anti-detection capabilities
- **Multiple C2 Protocols**: TCP, HTTP/HTTPS, and Telegram integration
- **Persistence Mechanisms**: Cross-platform persistence techniques
- **Encrypted Communication**: AES/XOR encryption for all communications
- **Builder System**: Automated payload generation and obfuscation
- **Advanced Integration**: Seamless integration with main NightStalker framework
- **Professional Reporting**: HTML and JSON reports with detailed analysis
- **Tool Management**: Universal tool manager with automatic dependency resolution

## 🆕 New Advanced Features

### 💀 Advanced Exploitation Integration
- **Multi-Phase Attack Chains**: Sophisticated attack sequences
- **Comprehensive Reconnaissance**: Automated target enumeration
- **Advanced Exploitation**: Sophisticated exploitation with configurable parameters
- **Professional Reporting**: HTML and JSON reports with detailed analysis

### 🎮 Enhanced CLI Integration
- **Unified Interface**: Access through main NightStalker CLI
- **Interactive Menus**: Hierarchical menu system with guided user experience
- **Command-Line Interface**: Advanced argument parsing with detailed help
- **Auto-Detection**: Automatic framework home directory detection

### 🔧 Tool Management
- **Universal Tool Manager**: Automatic detection and installation of required tools
- **Cross-Platform Support**: Windows, Linux, macOS package manager integration
- **Dependency Resolution**: Comprehensive tool dependency management

## 🏗️ Enhanced Architecture

```
malware_framework/
├── core/                   # Core framework components
│   ├── base_payload.py    # Base payload class
│   ├── c2_client.py       # C2 client base class
│   ├── encryption.py      # Encryption utilities
│   ├── stealth.py         # Anti-detection mechanisms
│   └── utils.py           # Common utilities
├── modules/               # Payload modules
│   ├── reverse_shell.py   # Reverse shell implementations
│   ├── keylogger.py       # Keylogging capabilities
│   ├── downloader.py      # File downloader
│   └── ransomware.py      # Ransomware simulator
├── c2/                    # Command & Control
│   ├── tcp_c2.py         # TCP-based C2
│   ├── http_c2.py        # HTTP/HTTPS C2
│   └── telegram_c2.py    # Telegram bot C2
├── persistence/           # Persistence mechanisms
│   ├── windows.py        # Windows persistence
│   ├── linux.py          # Linux persistence
│   └── macos.py          # macOS persistence
├── utils/                 # Utility modules
│   ├── obfuscation.py    # Code obfuscation
│   ├── sandbox_detection.py # Anti-VM/anti-debug
│   └── network.py        # Network utilities
├── config/               # Configuration files
│   ├── default.yaml      # Default configuration
│   └── templates/        # Payload templates
├── build/                # Output directory
├── logs/                 # Runtime logs
├── reports/              # Generated reports
├── main.py              # Main entry point
├── builder.py           # Payload builder
├── requirements.txt     # Dependencies
└── install.sh           # Installation script
```

## 🚀 Quick Start

### Installation

```bash
# Clone the repository
git clone <repository-url>
cd malware_framework

# Run the installer
sudo ./install.sh

# Or install manually
pip install -r requirements.txt
```

### Integration with Main Framework

```bash
# Use through main NightStalker framework
./nightstalker.sh payload build --type reverse_shell --format python

# Advanced exploitation
./nightstalker.sh redteam exploit --target 192.168.1.100 --type network

# Build stealth payloads
./nightstalker.sh stealth build --lhost 192.168.1.100 --lport 4444 --https
```

### Basic Usage

```bash
# Run with interactive menu
python main.py

# Build a payload
python builder.py --type reverse_shell --target 192.168.1.100:4444

# Run specific module
python main.py --module keylogger --config config/keylogger.yaml
```

## 🛠️ Available Modules

### Reverse Shells
- **TCP Reverse Shell**: Standard TCP-based reverse shell
- **HTTP Reverse Shell**: HTTP/HTTPS-based reverse shell
- **Encrypted Communication**: AES/XOR encryption support
- **Custom Delays**: Configurable callback intervals
- **Stealth Variants**: Advanced stealth reverse shells

### Keylogger
- **Stealth Operation**: Background keylogging
- **Configurable Dumps**: Custom log dump intervals
- **Encrypted Logs**: Optional log encryption
- **Cross-Platform**: Windows, Linux, macOS support
- **Anti-Detection**: Advanced anti-detection techniques

### Downloader
- **Remote File Retrieval**: Download files from remote sources
- **Proxy Support**: HTTP/SOCKS proxy support
- **Custom Headers**: Configurable HTTP headers
- **Resume Support**: Resume interrupted downloads
- **Encrypted Transfer**: Secure file transfer

### Ransomware Simulator
- **AES Encryption**: Strong file encryption
- **Key Management**: Secure key storage
- **Decryptor Builder**: Optional decryptor generation
- **File Targeting**: Configurable file extensions
- **Stealth Operation**: Advanced stealth capabilities

### Persistence Mechanisms
- **Windows**: Registry, Startup folder, Task Scheduler
- **Linux**: Cron jobs, .bashrc, systemd services
- **macOS**: LaunchAgents, Login Items, cron jobs
- **Advanced Persistence**: Sophisticated persistence techniques

## 🔧 Enhanced Configuration

### Main Configuration (`config/default.yaml`)

```yaml
# Framework settings
framework:
  name: "Malware Framework"
  version: "2.0.0"
  debug: false
  stealth_mode: true
  advanced_exploitation: true

# C2 settings
c2:
  protocol: "tcp"  # tcp, http, telegram
  host: "192.168.1.100"
  port: 4444
  encryption:
    enabled: true
    algorithm: "aes"
    key: "your-secret-key"

# Stealth settings
stealth:
  sandbox_detection: true
  debugger_detection: true
  vm_detection: true
  delay_jitter: 0.3
  user_agent: "Mozilla/5.0 (compatible; Framework/1.0)"
  anti_analysis: true
  obfuscation: true

# Persistence settings
persistence:
  enabled: true
  methods: ["registry", "startup"]
  cleanup: false
  advanced_persistence: true

# Advanced features
advanced_features:
  tool_management:
    auto_install: true
    cross_platform: true
    dependency_resolution: true
  
  reporting:
    html_reports: true
    json_export: true
    evidence_collection: true

# Logging settings
logging:
  level: "INFO"
  file: "logs/framework.log"
  max_size: "10MB"
  backup_count: 5
```

## 🔒 Enhanced Security Features

### Anti-Detection
- **Sandbox Detection**: VM and sandbox environment detection
- **Debugger Detection**: Anti-debugging techniques
- **Process Monitoring**: Detection of analysis tools
- **Timing Analysis**: Sleep timing and execution delays
- **Advanced Anti-Analysis**: Sophisticated anti-analysis techniques

### Obfuscation
- **String Encryption**: Runtime string decryption
- **Code Obfuscation**: Advanced code obfuscation
- **Import Hiding**: Dynamic import loading
- **Anti-Analysis**: Anti-disassembly techniques
- **Polymorphic Code**: Polymorphic code generation

### Communication Security
- **Encrypted Channels**: All C2 communication encrypted
- **Certificate Pinning**: SSL certificate validation
- **Proxy Support**: SOCKS/HTTP proxy support
- **Custom Protocols**: Custom communication protocols
- **Stealth Communication**: Advanced stealth communication

## 🏗️ Enhanced Builder System

### Command Line Builder

```bash
# Build reverse shell
python builder.py --type reverse_shell --target 192.168.1.100:4444 --output shell.exe

# Build keylogger
python builder.py --type keylogger --config config/keylogger.yaml --output keylogger.exe

# Build with obfuscation
python builder.py --type reverse_shell --obfuscate --encrypt-strings --output stealth.exe

# Build for specific platform
python builder.py --type reverse_shell --platform linux --output shell

# Build through main framework
./nightstalker.sh payload build --type reverse_shell --format exe --obfuscate
```

### Builder Features
- **Multiple Output Formats**: EXE, ELF, Mach-O, Python, PowerShell
- **Obfuscation Options**: String encryption, code obfuscation
- **Icon Spoofing**: Custom icons and metadata
- **Anti-Analysis**: Anti-debugging and anti-VM features
- **Advanced Obfuscation**: Polymorphic and metamorphic techniques

## 📡 Enhanced C2 Protocols

### TCP C2
- **Direct Connection**: TCP socket-based communication
- **Encrypted Channel**: AES encryption for all data
- **Command Execution**: Remote command execution
- **File Transfer**: Secure file upload/download
- **Stealth Operation**: Advanced stealth capabilities

### HTTP C2
- **Beaconing**: HTTP polling for commands
- **Encrypted Payloads**: Base64/AES encrypted data
- **Custom Headers**: Configurable HTTP headers
- **Proxy Support**: HTTP/SOCKS proxy support
- **HTTPS Support**: Secure HTTPS communication

### Telegram C2
- **Bot Integration**: Telegram bot-based C2
- **Encrypted Messages**: End-to-end encryption
- **File Sharing**: Secure file transfer
- **Stealth Operation**: Blend with normal traffic
- **Advanced Features**: Advanced Telegram integration

## 🎮 Integration with Main Framework

### Unified Interface
```bash
# Access through main NightStalker CLI
./nightstalker.sh payload build --type reverse_shell --format python

# Advanced exploitation
./nightstalker.sh redteam exploit --target 192.168.1.100 --type network

# Stealth operations
./nightstalker.sh stealth build --lhost 192.168.1.100 --lport 4444 --https

# C2 operations
./nightstalker.sh c2 server --host 0.0.0.0 --port 4444
```

### Advanced Capabilities
- **Attack Chains**: Multi-phase attack sequences
- **Professional Reporting**: HTML and JSON reports
- **Tool Management**: Universal tool manager
- **Cross-Platform**: Full Windows, Linux, and macOS support

## 🔧 Development

### Adding New Modules

1. Create module file in `modules/`
2. Inherit from `BasePayload`
3. Implement required methods
4. Add configuration in `config/`
5. Update builder and main CLI

### Example Module

```python
from core.base_payload import BasePayload
from typing import Dict, Any

class CustomModule(BasePayload):
    """Custom payload module"""
    
    def __init__(self, config: Dict[str, Any]):
        super().__init__(config)
        self.name = "custom_module"
    
    def execute(self) -> bool:
        """Execute the payload"""
        try:
            # Implementation here
            return True
        except Exception as e:
            self.logger.error(f"Execution failed: {e}")
            return False
```

## 📊 Professional Reporting

### HTML Reports
- **Comprehensive Analysis**: Detailed vulnerability analysis
- **Visual Presentation**: Professional HTML formatting
- **Evidence Collection**: Comprehensive evidence gathering
- **Timeline Analysis**: Attack timeline reconstruction

### JSON Export
- **Machine Readable**: Structured data export
- **API Integration**: Easy integration with other tools
- **Data Analysis**: Support for data analysis tools
- **Automation**: Automated report processing

## 🔒 Security & Ethics

**IMPORTANT**: This framework is designed for authorized security testing and educational purposes only.

- **Authorization Required**: Only test systems you own or have explicit permission to test
- **Educational Purpose**: Use for learning and authorized security assessments
- **No Malicious Use**: Do not use for unauthorized access or malicious activities
- **Compliance**: Follow all applicable laws and regulations
- **Responsible Disclosure**: Follow proper vulnerability disclosure procedures

## 📞 Support & Documentation

- **Main Documentation**: Check the main NightStalker documentation
- **Enhancement Summary**: Review `NIGHTSTALKER_ENHANCEMENT_SUMMARY.md`
- **Examples**: Review the example scripts in `examples/`
- **Testing**: Run tests in the `tests/` directory
- **Issues**: Report bugs on GitHub Issues

---

**Remember**: Always obtain proper authorization before testing any systems, and follow responsible disclosure practices when reporting vulnerabilities.

**Happy Hacking! 🎯** 