#!/usr/bin/env python3
"""
NightStalker Web Exploitation Framework Demo
Comprehensive demonstration of the framework capabilities
"""

import os
import sys
import json
import time
from pathlib import Path
from nightstalker.redteam.web_exploit_framework import NightStalkerWebExploitFramework

def print_banner():
    """Print framework banner"""
    banner = """
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                                                              â•‘
    â•‘  ğŸŒ™ NightStalker Web Exploitation Framework Demo            â•‘
    â•‘                                                              â•‘
    â•‘  Advanced web penetration testing platform                  â•‘
    â•‘  Integrated with NightStalker offensive security            â•‘
    â•‘                                                              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    print(banner)

def demo_framework_initialization():
    """Demonstrate framework initialization"""
    print("ğŸ”§ FRAMEWORK INITIALIZATION")
    print("=" * 50)
    
    # Initialize framework
    framework = NightStalkerWebExploitFramework()
    
    print(f"âœ… Framework initialized")
    print(f"ğŸ“ Base directory: {framework.base_dir}")
    print(f"ğŸ“ Modules directory: {framework.modules_dir}")
    print(f"ğŸ“ Loot directory: {framework.loot_dir}")
    print(f"ğŸ“ Tools directory: {framework.tools_dir}")
    
    return framework

def demo_tool_management(framework):
    """Demonstrate tool management capabilities"""
    print("\nğŸ› ï¸ TOOL MANAGEMENT")
    print("=" * 50)
    
    # Get tool status report
    status_report = framework.get_tool_status_report()
    
    print("ğŸ“Š Tool Status Report:")
    print("-" * 30)
    
    # Categorize tools
    categories = {}
    for tool_name, tool_info in status_report.items():
        category = tool_info["category"]
        if category not in categories:
            categories[category] = []
        categories[category].append((tool_name, tool_info))
    
    for category, tools in categories.items():
        print(f"\n{category.upper()}:")
        for tool_name, tool_info in tools:
            status_icon = "âœ…" if tool_info["status"] == "installed" else "âŒ"
            required = "Required" if tool_info["required"] else "Optional"
            print(f"  {status_icon} {tool_name} ({required}) - {tool_info['description']}")
    
    # Show installation options
    print(f"\nğŸ“‹ Installation Options:")
    print("  â€¢ framework.install_all_tools() - Install all required tools")
    print("  â€¢ framework.install_tool('tool_name') - Install specific tool")
    print("  â€¢ framework.check_tool_status('tool_name') - Check tool status")

def demo_target_management(framework):
    """Demonstrate target management"""
    print("\nğŸ¯ TARGET MANAGEMENT")
    print("=" * 50)
    
    # Example targets
    example_targets = [
        "https://httpbin.org",
        "https://example.com",
        "https://testphp.vulnweb.com"
    ]
    
    print("ğŸ“‹ Example Targets:")
    for i, target in enumerate(example_targets, 1):
        print(f"  {i}. {target}")
    
    # Set target
    target = example_targets[0]  # Use httpbin for demo
    framework.set_target(target)
    
    print(f"\nâœ… Target set: {target}")
    print(f"ğŸ“ Target directory created: {framework.loot_dir / target}")
    
    # Show target structure
    target_dir = framework.loot_dir / target
    if target_dir.exists():
        print(f"\nğŸ“‚ Target directory structure:")
        for subdir in ["recon", "exploit", "bruteforce", "post", "screenshots", "logs"]:
            subdir_path = target_dir / subdir
            if subdir_path.exists():
                print(f"  ğŸ“ {subdir}/")

def demo_reconnaissance(framework):
    """Demonstrate reconnaissance capabilities"""
    print("\nğŸ” RECONNAISSANCE DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    # Available reconnaissance tools
    recon_tools = ["nuclei", "nikto", "dirsearch", "httpx", "wpscan"]
    
    print(f"\nğŸ“‹ Available Reconnaissance Tools:")
    for tool in recon_tools:
        status = framework.check_tool_status(tool)
        status_text = "âœ… Available" if status.value == "installed" else "âŒ Missing"
        print(f"  {status_text} - {tool}")
    
    print(f"\nğŸš€ Running Reconnaissance...")
    
    # Run reconnaissance (simulated for demo)
    print("  ğŸ” Running basic reconnaissance...")
    print("  ğŸ“Š Gathering server information...")
    print("  ğŸ” Enumerating technologies...")
    print("  ğŸ“ Scanning directories...")
    print("  ğŸŒ Checking subdomains...")
    
    # Simulate results
    recon_results = {
        "nuclei": {"success": True, "output": "Vulnerability scan completed"},
        "nikto": {"success": True, "output": "Web server scan completed"},
        "dirsearch": {"success": True, "output": "Directory enumeration completed"}
    }
    
    print(f"\nâœ… Reconnaissance completed!")
    print(f"ğŸ“Š Results saved to: {framework.loot_dir / target / 'recon'}")

def demo_exploitation(framework):
    """Demonstrate exploitation capabilities"""
    print("\nğŸ’¥ EXPLOITATION DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    # Available exploitation tools
    exploit_tools = ["sqlmap", "msfconsole", "nuclei"]
    
    print(f"\nğŸ“‹ Available Exploitation Tools:")
    for tool in exploit_tools:
        status = framework.check_tool_status(tool)
        status_text = "âœ… Available" if status.value == "installed" else "âŒ Missing"
        print(f"  {status_text} - {tool}")
    
    print(f"\nğŸš€ Running Exploitation...")
    
    # Simulate exploitation
    print("  ğŸ” Testing for SQL injection vulnerabilities...")
    print("  ğŸ¯ Attempting XSS exploitation...")
    print("  ğŸ“ Testing for file inclusion vulnerabilities...")
    print("  ğŸ” Attempting authentication bypass...")
    
    # Simulate results
    exploit_results = {
        "sqlmap": {"success": False, "output": "No SQL injection vulnerabilities found"},
        "nuclei": {"success": True, "output": "Vulnerability scan completed"}
    }
    
    print(f"\nâœ… Exploitation completed!")
    print(f"ğŸ“Š Results saved to: {framework.loot_dir / target / 'exploit'}")

def demo_bruteforce(framework):
    """Demonstrate bruteforce capabilities"""
    print("\nğŸ”¨ BRUTEFORCE DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    # Available bruteforce tools
    bruteforce_tools = ["openbullet", "hydra"]
    
    print(f"\nğŸ“‹ Available Bruteforce Tools:")
    for tool in bruteforce_tools:
        status = framework.check_tool_status(tool)
        status_text = "âœ… Available" if status.value == "installed" else "âŒ Missing"
        print(f"  {status_text} - {tool}")
    
    print(f"\nğŸš€ Running Bruteforce...")
    
    # Simulate bruteforce
    print("  ğŸ” Testing common credentials...")
    print("  ğŸ“ Attempting password spraying...")
    print("  ğŸ¯ Testing default accounts...")
    print("  ğŸ“Š Analyzing authentication mechanisms...")
    
    print(f"\nâœ… Bruteforce completed!")
    print(f"ğŸ“Š Results saved to: {framework.loot_dir / target / 'bruteforce'}")

def demo_post_exploitation(framework):
    """Demonstrate post-exploitation capabilities"""
    print("\nğŸ”§ POST-EXPLOITATION DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    # Available post-exploitation tools
    post_tools = ["msfconsole", "nc"]
    
    print(f"\nğŸ“‹ Available Post-Exploitation Tools:")
    for tool in post_tools:
        status = framework.check_tool_status(tool)
        status_text = "âœ… Available" if status.value == "installed" else "âŒ Missing"
        print(f"  {status_text} - {tool}")
    
    print(f"\nğŸš€ Running Post-Exploitation...")
    
    # Simulate post-exploitation
    print("  ğŸ” Privilege escalation attempts...")
    print("  ğŸ“ Lateral movement...")
    print("  ğŸ“Š Data exfiltration...")
    print("  ğŸ” Persistence establishment...")
    print("  ğŸ§¹ Trace clearing...")
    
    print(f"\nâœ… Post-exploitation completed!")
    print(f"ğŸ“Š Results saved to: {framework.loot_dir / target / 'post'}")

def demo_reporting(framework):
    """Demonstrate reporting capabilities"""
    print("\nğŸ“Š REPORTING DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    print(f"\nğŸš€ Generating Comprehensive Report...")
    
    # Simulate comprehensive assessment
    print("  ğŸ“‹ Collecting reconnaissance data...")
    print("  ğŸ’¥ Gathering exploitation results...")
    print("  ğŸ”¨ Compiling bruteforce findings...")
    print("  ğŸ”§ Analyzing post-exploitation activities...")
    print("  ğŸ“Š Generating executive summary...")
    print("  ğŸ¨ Creating HTML report...")
    
    # Simulate report generation
    report_file = f"web_exploit_report_{int(time.time())}.html"
    
    print(f"\nâœ… Report generated successfully!")
    print(f"ğŸ“„ Report file: {report_file}")
    print(f"ğŸŒ Open in browser to view detailed report")

def demo_integration(framework):
    """Demonstrate NightStalker integration"""
    print("\nğŸŒ™ NIGHTSTALKER INTEGRATION DEMO")
    print("=" * 50)
    
    target = "https://httpbin.org"
    print(f"ğŸ¯ Target: {target}")
    
    print(f"\nğŸš€ Running Integrated Assessment...")
    
    # Simulate integrated assessment
    print("  ğŸŒ™ NightStalker web red teaming scan...")
    print("  ğŸ”§ Web exploitation framework scan...")
    print("  ğŸ“Š Combining results...")
    print("  ğŸ¨ Generating integrated report...")
    
    print(f"\nâœ… Integrated assessment completed!")
    print(f"ğŸ“„ Comprehensive report generated")
    print(f"ğŸ”— Both frameworks working together seamlessly")

def demo_advanced_features(framework):
    """Demonstrate advanced features"""
    print("\nğŸš€ ADVANCED FEATURES DEMO")
    print("=" * 50)
    
    print("ğŸ“‹ Advanced Capabilities:")
    print("  ğŸ”§ Proxy Configuration")
    print("    - SOCKS5 proxy support")
    print("    - HTTP proxy support")
    print("    - Proxychains integration")
    
    print("\n  ğŸŒ Tunnel Configuration")
    print("    - Ngrok integration")
    print("    - LocalTunnel support")
    print("    - SSH tunneling")
    
    print("\n  ğŸ³ Docker Integration")
    print("    - Containerized tools")
    print("    - OpenBullet 2 Docker")
    print("    - Metasploit Docker")
    
    print("\n  ğŸ“Š Advanced Reporting")
    print("    - HTML reports")
    print("    - JSON exports")
    print("    - Timeline analysis")
    print("    - Evidence collection")
    
    print("\n  ğŸ”„ Automation")
    print("    - Automated tool installation")
    print("    - Scheduled scans")
    print("    - Continuous monitoring")

def demo_cli_usage():
    """Demonstrate CLI usage"""
    print("\nğŸ–¥ï¸ CLI USAGE EXAMPLES")
    print("=" * 50)
    
    print("ğŸ“‹ Framework Commands:")
    print("  python -m nightstalker.cli webred scan --url https://target.com")
    print("  python -m nightstalker.cli webred exploit --url https://target.com --exploit sqlmap")
    print("  python -m nightstalker.cli webred post-exploit --target-info scan.json --gain-root")
    print("  python -m nightstalker.cli webred clear-traces --target-info exploit.json --aggressive")
    print("  python -m nightstalker.cli webred report --input results.json --output report.html")
    
    print("\nğŸ“‹ Installer Commands:")
    print("  python install_web_exploit_framework.py")
    print("  python install_web_exploit_framework.py --verbose")
    print("  python install_web_exploit_framework.py --skip-docker")
    print("  python install_web_exploit_framework.py --install-only sqlmap nuclei")
    
    print("\nğŸ“‹ TUI Commands:")
    print("  python -m nightstalker.redteam.web_exploit_tui")
    print("  python nightstalker/redteam/web_exploit_tui.py")

def main():
    """Main demonstration function"""
    print_banner()
    
    print("âš ï¸  DISCLAIMER: This is a demonstration script.")
    print("   Only use on authorized targets with proper permission.")
    print("   This demo uses safe, public test targets.\n")
    
    try:
        # Initialize framework
        framework = demo_framework_initialization()
        
        # Demonstrate capabilities
        demo_tool_management(framework)
        demo_target_management(framework)
        demo_reconnaissance(framework)
        demo_exploitation(framework)
        demo_bruteforce(framework)
        demo_post_exploitation(framework)
        demo_reporting(framework)
        demo_integration(framework)
        demo_advanced_features(framework)
        demo_cli_usage()
        
        print("\n" + "=" * 60)
        print("ğŸ¯ DEMONSTRATION COMPLETE!")
        print("=" * 60)
        
        print("\nğŸ“‹ What You've Seen:")
        print("  âœ… Framework initialization and setup")
        print("  âœ… Tool management and installation")
        print("  âœ… Target management and organization")
        print("  âœ… Reconnaissance capabilities")
        print("  âœ… Exploitation techniques")
        print("  âœ… Bruteforce capabilities")
        print("  âœ… Post-exploitation activities")
        print("  âœ… Comprehensive reporting")
        print("  âœ… NightStalker integration")
        print("  âœ… Advanced features")
        print("  âœ… CLI and TUI interfaces")
        
        print("\nğŸš€ Next Steps:")
        print("  1. Install the framework: python install_web_exploit_framework.py")
        print("  2. Set up your first target")
        print("  3. Run reconnaissance: framework.run_reconnaissance('target')")
        print("  4. Explore exploitation: framework.run_exploitation('target')")
        print("  5. Generate reports: framework.generate_report('target')")
        print("  6. Try the TUI: python -m nightstalker.redteam.web_exploit_tui")
        
        print("\nğŸ“š Documentation:")
        print("  - Framework Guide: WEB_EXPLOIT_FRAMEWORK_README.md")
        print("  - Web Red Teaming: WEB_RED_TEAMING_GUIDE.md")
        print("  - Installation Log: Check install.log for details")
        
        print("\nğŸ”’ Remember:")
        print("  - Always obtain proper authorization")
        print("  - Follow responsible disclosure practices")
        print("  - Keep tools updated regularly")
        print("  - Document all activities")
        
    except KeyboardInterrupt:
        print("\n\nâš ï¸  Demonstration interrupted by user")
    except Exception as e:
        print(f"\n\nâŒ Error during demonstration: {e}")
        print("Check that all dependencies are installed correctly")

if __name__ == "__main__":
    main() 